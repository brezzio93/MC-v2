<!-- Game Options Component -->
<h2> Configuraci√≥n de Partida </h2>

<!-- Players Quantity -->
<dx-number-box 
    label="Jugadores"
    labelMode="floating"
    [showSpinButtons]="false"
    [min]="1"
    [max]="4"
    [value]="playersQty"
    (onValueChanged)="onPlayersQtyChange($event.value)"
    >
</dx-number-box>

@for(i of [].constructor(playersQty); track i) {
    <!-- Hero Selector -->
    <dx-select-box
        label="Jugador {{$index + 1}}"
        labelMode="floating"
        [searchEnabled]="true"
        [items]="heroes"
        displayExpr="text"
        valueExpr="card_set_code"
        (onValueChanged)="onPlayerHeroChange($event.value, $index)"
        >
    </dx-select-box>
}

<!-- Villain Selector -->
<dx-select-box
    label="Villano"
    labelMode="floating"
    [searchEnabled]="true"
    [items]="villains"
    displayExpr="text"
    valueExpr="card_set_code"
    (onValueChanged)="onEncounterSelected($event.value)"
    >
</dx-select-box>
<!-- Modular Sets -->
<dx-tag-box
    label="Encuentros modulares"
    labelMode="floating"
    [multiline]="true"
    [searchEnabled]="true"
    [showSelectionControls]="true"
    applyValueMode="useButtons"
    [dataSource]="modularSets"
    valueExpr="card_set_code"
    displayExpr="text"
    >
</dx-tag-box>

<hr>

<!-- Match Preview-->
<div>
    <!-- Villain Content -->
    @if(villain != null) {
    
        <!-- Phase TAB -->
        <dx-tabs
            [items]="villain.villain_phases"
            [selectedIndex]="villainPhase"
            keyExpr="code"
            [showNavButtons]="true"
            (onItemClick)="setInitVillainPhase($event)"
        >
        @for(phase of villain.villain_phases; track phase) {
            <dxi-item>
                <div *dxTemplate>
                    <div id="{{phase.code}}"> {{phase.real_name}} {{phase.stage}} </div>
                </div>
            </dxi-item>
        }
        </dx-tabs>
    
        <!-- Details -->
        <div style="display: flex; justify-content: space-between; background-color: darkred;">
            <div style="width: 33%">
                @if(villain.villain_phases != null) {
                    <img 
                        style="width: 60%; margin: 1rem; display: block;"
                        [src]="'https://es.marvelcdb.com'+villain.villain_phases[villainPhase].imagesrc"
                        alt="{{ villain.villain_phases[villainPhase].name }}" />
                        
                    <!-- HP -->
                    <h3 style="color: white; text-align: center;"> {{villain.currentHP}} / {{ villain.villain_phases[villainPhase].health * playersQty }} HP</h3>
                }
            </div>
            <div style="width: 33%;">
                @if(villain.main_scheme != null && villain.main_scheme.length > 0) {
                    @for(scheme of villain.main_scheme; track scheme) {
                        <img 
                            style="width: 90%; margin: 1rem 0 1rem 0; display: block;"
                            [src]="scheme.imagesrc"
                            alt="{{ scheme.name }}" 
                        />
                        
                        <!-- Threat -->
                        <h4 style="color: white; text-align: center; margin: 0.5rem 0;"> {{ scheme.baseThreat }} / {{ scheme.maxThreat }} Amenaza </h4>
                        <h4 style="color: white; text-align: center; margin: 0.5rem 0;"> Aumento: {{ scheme.escalationThreat }} </h4>
                    }
                }
            </div>
        </div>
    }
    
    <!-- Hero Content -->
    @for(i of [].constructor(playersQty); track i) {
        @if(heroPlayers[$index] != null) {
            <div style="display: flex; justify-content: space-between; margin-top: 1rem; " [ngStyle]="{'background':heroPlayers[$index]?.colors}">
                <div style="width: 33%;">
                    <img 
                        style="width: 60%; margin: 1rem; display: block;"
                        [src]="'https://es.marvelcdb.com'+ heroPlayers[$index].imagesrc"
                        />
                        
                    <!-- HP -->
                    <h3 style="color: white; text-align: center; margin: 0;"> {{heroPlayers[$index].currentHP}} / {{ heroPlayers[$index]?.health }} HP</h3>
                </div>
            </div>        
        }
    }
</div>


<!-- Start Game Button -->
<dx-button
    style="position:fixed; bottom:0; right: 2%;"
    (onClick)="onStartGame()" 
    text="Comenzar Juego">
</dx-button>